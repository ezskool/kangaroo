
Android comes with an ready-to-use implementation of a SQLite database system which is the one to use in our project to store routing data (cf. chapter \ref{sub:routing_mobiletsm}). It seems reasonable to include all routing data in one database file and to preprocess it in a way that keeps operation expense on the mobile device at a minimum. The follow sections will give details on the database structure and the tools used to convert an Openstreetmap XML to such a database file, including the just mentioned preprocessing.

\subsubsection{Significant map elements for routing data}

The Openstreetmap XML file consists of a set of node, a set of ways and a (for this project dispensable) set of relations. Although in principle every node and way has the same "weight", significance for our application may vary over a huge scale. This significance depends on the attributes of the according map element. Three types of map elements are of high significance:

\begin{itemize}
	\item selected ways
	
		As Openstreetmap also uses ways to map buildings or areas of a special type, public stairways or almost impassable trails, one is forced to drop every way that cannot be considered to be a "standard street"\footnote{we assume the user is not willing to travel such almost impassable trails as a pedestrian}. This selection is based on the tags associated with a way. 
	
	\item selected street nodes
	
		The nodes spanning up a way that wasn't dropped are considered to be significant to our application.\newline
		
		Furthermore, street nodes are (as already mentioned several times) split into two categories. \emph{Intermediate way nodes} may be dropped without any impact on a routing operation traversing the way, whereas \emph{essential street nodes} cannot (cf. chapter \ref{sub:routing_mobiletsm} for details).
		
	\item selected POI\footnote{Point Of Interest} nodes
	
		Nodes that are tagged as an "amenity" or a "shop" of any type are considered to be significant to our application.

\end{itemize}

Note that dropping map elements needs to be done with care to yield a coherent reduced map, since one has to be aware of reciprocal   dependencies between map elements.\newline

\subsubsection{Structure of routing database}

According to the structural demands the database basically consists of four tables:

\begin{itemize}

	\item \texttt{ways\_0}		
						
		Every row in this table represents a way.\newline

		\begin{tabular}[ht]{|p{2.5cm}|p{3.5cm}|p{8.5cm}|}
			\hline
			column & data type & description \\
			\hline\hline
			 id & integer primary key & unique way id (= OSM id)\\
			 name & text not null & name of this way (= OSM 'name' tag)\\	
			 highway & text not null & = OSM 'highway' tag\\
			 maxspeed & integer not null & maximum speed in km/h (= OSM 'maxspeed' tag)\\			 
			 tags & text not null & serialized OSM tags\\
			 flags & integer not null & \emph{unused up to now}\\				 
			 waynodes & text not null & serialized list of way nodes\\
			 waynodes\_red & text not null & serialized list of reduced way nodes\\
			\hline
		\end{tabular}\newline

	
	\item \texttt{street\_nodes\_0}

		Every row in this table represents a street node independently of wether it is an intermediate or an essential way node.\newline

		\begin{tabular}[ht]{|p{2.5cm}|p{3.5cm}|p{8.5cm}|}
			\hline
			column & data type & description \\
			\hline\hline
			 id & integer primary key & unique node id (= OSM id)\\	
			 lat & real not null & latitude of node\\			 
			 lon & real not null & longitude of node\\	
			 tags & text not null & serialized OSM tags\\			 
			 ways & text not null & serialized list of ways connected to this node\\	
			 type & integer not null & type of street node (intermediate/essential)\\				 
			\hline
		\end{tabular}\newline
	
	\item \texttt{poi\_nodes\_0}

		Every row in this table represents a Point Of Interest.\newline
		
		\begin{tabular}[ht]{|p{2.5cm}|p{3.5cm}|p{8.5cm}|}
			\hline
			column & data type & description \\
			\hline\hline
			 id & integer primary key & unique node id (= OSM id)\\	
			 lat & real not null & latitude of node\\			 
			 lon & real not null & longitude of node\\
			 poicode & integer not null & type code of Point Of Interest\\	
			 tags & text not null & serialized OSM tags\\			 
			 nst & integer not null & id of nearest street node\\			 
			\hline
		\end{tabular}\newline
	
	\item \texttt{index}
	
		At the current stage of the project, this table does not contain any crucial data. It is rather intended to be used in future when the map area is split into disjunctive tiles. It then may contain a kind of table of contents stored as key-value-pairs.\newline
		
		\begin{tabular}[ht]{|p{2.5cm}|p{3.5cm}|p{8.5cm}|}
			\hline
			column & data type & description \\
			\hline\hline
			 id & integer primary key & unique id of key-value-pair\\	
			 key & text not null & unique key\\			 
			 value & text not null & value of key\\
			\hline
		\end{tabular}\newline
		
\end{itemize}

Note: to be compliant with Android's SQLite database, the database has to contain a table \texttt{android\_metadata} with a specification of the used locale.


\subsubsection{Creation of routing database}

As Openstreetmap is the origin of the routing data to be used, one needs a converter reading the Openstreetmap XML file and writing an Android compliant SQLite .db database file. This conversion is done by a class called \texttt{MobileTSMDatabaseWriter}.\newline

It automatically selects map elements of desired significance and outputs an reduced, coherent map stored in a database file of the previously explained format. This file can directly by copied to the mobile device to be used as a routing data source.